#!/bin/bash

# ⚡ ШВИДКИЙ СКРИПТ З ШАБЛОНАМИ ДЛЯ СТВОРЕННЯ ЗВІТІВ
# Використання: ./tools/scripts/documentation/fast_report.sh [шаблон] [назва]
# Шаблони: 
#   security - звіт про безпеку
#   bugfix - звіт про виправлення багу
#   feature - звіт про нову функцію
#   daily - щоденний звіт
#   weekly - тижневий звіт

set -e

# Кольори для виводу
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
BLUE='\033[0;34m'
NC='\033[0m'

# Функція для логування
log() {
    echo -e "${GREEN}[FAST]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Перевірка аргументів
if [ $# -lt 2 ]; then
    error "Використання: $0 [шаблон] [назва]"
    echo "Шаблони:"
    echo "  security - звіт про безпеку"
    echo "  bugfix - звіт про виправлення багу"
    echo "  feature - звіт про нову функцію"
    echo "  daily - щоденний звіт"
    echo "  weekly - тижневий звіт"
    echo "Приклади:"
    echo "  $0 security 'auth-vulnerability-fix'"
    echo "  $0 bugfix 'api-endpoint-error'"
    echo "  $0 feature 'oauth-integration'"
    exit 1
fi

TEMPLATE="$1"
NAME="$2"
CURRENT_DATE=$(date +"%Y-%m-%d")
CURRENT_TIME=$(date +"%H:%M")

# Визначення типу та папки
case $TEMPLATE in
    "security")
        TYPE="update"
        FOLDER="docs/newspaper/report"
        ;;
    "bugfix")
        TYPE="update"
        FOLDER="docs/newspaper/report"
        ;;
    "feature")
        TYPE="work_results"
        FOLDER="docs/newspaper/report"
        ;;
    "daily")
        TYPE="work_results"
        FOLDER="docs/newspaper/report"
        ;;
    "weekly")
        TYPE="work_results"
        FOLDER="docs/newspaper/report"
        ;;
    *)
        error "Невідомий шаблон: $TEMPLATE"
        exit 1
        ;;
esac

# Отримання наступного ID
NEXT_ID=$(./tools/scripts/documentation/get_next_newspaper_id.sh "$TYPE")

if [ -z "$NEXT_ID" ]; then
    error "Не вдалося отримати наступний ID"
    exit 1
fi

# Створення назви файлу
FILENAME="${NEXT_ID}_${TYPE}_${NAME}.md"
FILEPATH="$FOLDER/$FILENAME"

# Створення звіту за шаблоном
log "Створення швидкого звіту за шаблоном '$TEMPLATE': $FILENAME"

case $TEMPLATE in
    "security")
        cat > "$FILEPATH" << EOF
# Безпека: $NAME

**Дата**: $CURRENT_DATE $CURRENT_TIME  
**Тип**: Оновлення безпеки  
**Пріоритет**: 🔴 Високий  
**Статус**: ✅ Завершено

## 🛡️ **Проблема безпеки**

[Опис вразливості або проблеми]

## ✅ **Виконані дії**

- [x] Виявлено вразливість
- [x] Виправлено проблему
- [x] Протестовано виправлення
- [x] Оновлено документацію

## 🔒 **Технічні деталі**

- **Тип вразливості**: [SQL Injection/XSS/CSRF/etc]
- **Серйозність**: [Критична/Висока/Середня/Низька]
- **Вплив**: [Опис впливу]

## 📊 **Результат**

[Результат виправлення]

**Статус**: ✅ Завершено  
**Дата**: $CURRENT_DATE $CURRENT_TIME
EOF
        ;;
    "bugfix")
        cat > "$FILEPATH" << EOF
# Виправлення багу: $NAME

**Дата**: $CURRENT_DATE $CURRENT_TIME  
**Тип**: Оновлення  
**Пріоритет**: 🟡 Середній  
**Статус**: ✅ Завершено

## 🐛 **Опис багу**

[Детальний опис проблеми]

## ✅ **Виконані дії**

- [x] Відтворено баг
- [x] Знайдено причину
- [x] Виправлено код
- [x] Протестовано виправлення

## 🔧 **Технічні деталі**

- **Файл**: [шлях до файлу]
- **Функція**: [назва функції]
- **Причина**: [причина багу]

## 📊 **Результат**

[Результат виправлення]

**Статус**: ✅ Завершено  
**Дата**: $CURRENT_DATE $CURRENT_TIME
EOF
        ;;
    "feature")
        cat > "$FILEPATH" << EOF
# Нова функція: $NAME

**Дата**: $CURRENT_DATE $CURRENT_TIME  
**Тип**: Результати роботи  
**Статус**: ✅ Завершено

## 🚀 **Опис функції**

[Детальний опис нової функції]

## ✅ **Виконані завдання**

- [x] Планування функції
- [x] Розробка коду
- [x] Тестування
- [x] Документація

## 📊 **Результати**

- Створено новий компонент
- Реалізовано функціонал
- Додано тести
- Оновлено документацію

## 🔧 **Технічні деталі**

- **Файли**: [список файлів]
- **API**: [нові endpoints]
- **База даних**: [зміни в БД]

**Статус**: ✅ Завершено  
**Дата**: $CURRENT_DATE $CURRENT_TIME
EOF
        ;;
    "daily")
        cat > "$FILEPATH" << EOF
# Щоденний звіт: $NAME

**Дата**: $CURRENT_DATE $CURRENT_TIME  
**Тип**: Результати роботи  
**Період**: День  
**Статус**: ✅ Завершено

## 📋 **План на день**

- [x] Завдання 1
- [x] Завдання 2
- [x] Завдання 3

## ✅ **Виконані завдання**

- [x] Основна робота
- [x] Додаткові завдання
- [x] Тестування

## 📊 **Результати дня**

[Що було досягнуто за день]

## 🎯 **Плани на завтра**

- [ ] Завдання 1
- [ ] Завдання 2

**Статус**: ✅ Завершено  
**Дата**: $CURRENT_DATE $CURRENT_TIME
EOF
        ;;
    "weekly")
        cat > "$FILEPATH" << EOF
# Тижневий звіт: $NAME

**Дата**: $CURRENT_DATE $CURRENT_TIME  
**Тип**: Результати роботи  
**Період**: Тиждень  
**Статус**: ✅ Завершено

## 📋 **План на тиждень**

- [x] Основні завдання
- [x] Додаткові завдання
- [x] Тестування

## ✅ **Виконані завдання**

- [x] Модуль 1
- [x] Модуль 2
- [x] Інтеграція

## 📊 **Результати тижня**

[Що було досягнуто за тиждень]

## 🎯 **Плани на наступний тиждень**

- [ ] Новий модуль
- [ ] Покращення
- [ ] Тестування

**Статус**: ✅ Завершено  
**Дата**: $CURRENT_DATE $CURRENT_TIME
EOF
        ;;
esac

log "✅ Швидкий звіт створено: $FILEPATH"

# Показ створеного файлу
echo ""
echo "📄 Створений файл:"
echo "  Шаблон: $TEMPLATE"
echo "  Тип: $TYPE"
echo "  ID: $NEXT_ID"
echo "  Назва: $NAME"
echo "  Шлях: $FILEPATH"
echo ""

log "Звіт готовий! Можна редагувати далі 🎉" 